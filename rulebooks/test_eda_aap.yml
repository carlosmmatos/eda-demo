---
- name: EDA Event Stream test AAP
  hosts: all
  sources:
    - crowdstrike.falcon.eventstream:
        falcon_client_id: "{{ FALCON_CLIENT_ID }}"
        falcon_client_secret: "{{ FALCON_CLIENT_SECRET }}"
        falcon_cloud: "{{ FALCON_CLOUD }}"
        offset: 166317
        stream_name: "eda-example-test"
        include_event_types:
          - "DetectionSummaryEvent"

  rules:
    - name: DEBUG on AAP if severity is high|critical
      condition: event.falcon.event.Severity > 3
      action:
        run_job_template:
          name: test_eda_aap
          organization: Default
          job_args:
            extra_vars:
              computer_name: "{{ event.falcon.event.ComputerName }}"
              detection_description: "{{ event.falcon.event.DetectDescription }}"
        # run_playbook:
        #   name: tests/eda_slack.yml
        #   extra_vars:
        #     computer_name: "{{ event.falcon.event.ComputerName }}"
        #     detection_description: "{{ event.falcon.event.DetectDescription }}"
